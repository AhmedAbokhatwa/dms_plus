<div class="print-container">
    <!-- Header -->
    <div class="header">
        <div class="image-container">
            <img src="/private/files/DMS-Header.jpg.png" alt="">
        </div>
        <h1>فاتورة أولية</h1>
        <!-- Invoice Info -->
        <div class="invoice-info">
            <div class="supplier-section">
                <h3>المورد</h3>
                <div class="supplier-details">
                    <div>اسم الشركة : {{doc.company}}</div>
                    {% set company_doc = frappe.get_doc("Company", doc.company) %}
                    <div>سجل تجاري: {{ company_doc.registration_details or "-" }}</div>
                    <div>الرقم الضريبي: {{ company_doc.tax_id or "-" }}</div>
                    <div>العنوان الوطني: {{ company_doc.address_html or "-" }}</div>
                </div>

            </div>
            <!-- Customer Section -->
            <div class="customer-section">
                <h3>العميل</h3>
                <div class="customer-details">
                    <div>اسم الشركة: {{ doc.customer_name or "-" }}</div>
                    <div>سجل تجاري: {{ doc.customer_registration_no or "-" }}</div>
                    <div>الرقم الضريبي: {{ doc.tax_id or "-" }}</div>
                    <div>العنوان الوطني: {{ doc.customer_primary_address or "-" }}</div>
                    <div>رقم الفاتورة: {{ doc.name }}</div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <table>
            <thead>
                <tr>
                    <!-- <th>#</th> -->
                    <th> التسلسل</th>
                    <th>اسم الصنف</th>
                    <th>الوصف</th>
                    <th>الكمية</th>
                    <th>سعر الوحدة</th>
                    <th>نسبة الخصم</th>
                    <th>قيمة الخصم</th>
                    <th>الأجمالي</th>
                </tr>
            </thead>

            <tbody>
                {% for item in doc.items %}
                <tr>
                    <!-- <td>{{ loop.index }}</td> -->
                    <td>{{ item.item_code }}</td>
                    <td>{{ item.item_name }}</td>
                    <td style="width: 100%; height:100%">{{ item.description }}</td>
                    <td>{{ item.qty }}</td>
                    <td>
                        {{ "%.2f"|format(item.rate) }}
                    </td>
                    <td>
                        {% if item.discount_amount %}
                        {{ "%.2f"|format((item.discount_amount / (item.rate * item.qty)) * 100) }}%
                        {% else %}
                        0%
                        {% endif %}
                    </td>

                    <td>{% if item.discount_amount %}
                        {{ "%.2f"|format(item.discount_amount) }}
                        {% else %} 0.00
                        ر.س
                        {% endif %}
                    </td>

                    <td>{{ "%.2f"|format(item.amount) }} ر.س</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <div class="totals">

                <div class="total-row">
                    <span> اجمالى المبلغ قبل الضريبة</span>
                    <span>{{ "%.2f"|format(doc.total) }} ر.س</span>
                </div>

                {% if doc.discount_amount %}
                <div class="total-row">
                    <span> مبلغ الخصم الاضافي:</span>
                    <span>{{ "%.2f"|format(doc.discount_amount) }} ر.س</span>
                </div>

                <div class="total-row">
                    <span> مبلغ بعد الخصم :</span>
                    <span>{{ "%.2f"|format(doc.net_total) }} ر.س</span>
                </div>
                {% endif %}

                {% if doc.total_taxes_and_charges %}
                <div class="total-row">
                    <span>نسبة الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.total_taxes_and_charges) }} ر.س</span>
                </div>
                <div class="total-row">
                    <span>قيمة الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.total_taxes_and_charges/ (doc.net_total)*100) }} %</span>
                </div>
                {% endif %}
                <div class="total-row final">
                    <span> الاجمالى بعد الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.grand_total) }} ر.س</span>
                </div>
                <div class="total-row final">
                    <span>المبلغ الكلي :</span>
                    <span>{{ "%.2f"|format(doc.grand_total) }} ر.س</span>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="image-container">
                <img src="/private/files/DMS-Footer.jpg" alt="">
            </div>

        </div>

    </div>
    <style>
        @font-face {
            font-family: 'IBM-Plex-Arabic';
            src: url('/private/files/IBM Plex Arabic SemiBold.otf') format('opentype');
        }

        .print-format {
            top: 0;
            position: relative;
            background-color: white;
            border-radius: 10px !important;
            max-width: 8.3in;
            min-height: 11.69in;
            font-family: 'IBM-Plex-Arabic';

        }

        .print-format .print-container {
            position: absolute;
            width: 100%;
            height: 93%;
            padding: 25px;
            margin: -12px -70px;

        }

        .image-container {
            text-align: center;
            margin-bottom: 10px;
            /* border: 1px solid red; */
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            object-fit: cover;
        }

        .header h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }

        .invoice-info {
            /* border: 1px solid red; */
            direction: rtl;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;

        }

        .invoice-info h3 {
            margin-bottom: 10px;
            color: #118493;
            border-bottom: 1px solid #118493;
        }

        .supplier-section,
        .customer-section {
            width: 48%;
            padding: 0px 50px;
        }

        .supplier-details div,
        .customer-details div {
            margin-bottom: 5px;
        }

        /*============== table ===============*/

        table {
            direction: rtl;
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        table th,
        table td {
            border: 1px solid #ddd;
            text-align: right;
            padding: 8px;
        }

        table th {
            background-color: #f2f2f2;
            color: #118493;
            font-size: 12px;
            font-weight: bold;

        }

        table tbody tr:nth-child(odd) {
            background-color: #ffffff;
        }

        table tbody tr:nth-child(even) {
            background-color: #f8fbfd;
        }

        table tbody tr:hover {
            background-color: #f0f5f9;
        }

        table td {

            font-size: 13px;
            color: #333;
            text-align: right;
        }

        table td:first-child {
            text-align: center;
            font-weight: bold;
            color: #666;
            width: 5%;
        }

        /* total section */
        .totals-section {
            /* border: 1px solid red; */
            direction: rtl;
            text-align: right;
            padding: 10px 50px;
        }

        .totals .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .totals .total-row.final {
            font-weight: bold;
            font-size: 12px;
        }

        /* footer */
        .footer {
            position: absolute;
            bottom: 0;
            margin-top: 20px;
            text-align: center;
        }


        /* ========================================================== */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            .print-format .print-container {
                position: absolute;
                width: 100%;
                height: 93%;
                padding: 25px;
                margin: -12px -10px;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;

            }

            @font-face {
                font-family: 'IBM-Plex-Arabic';
                src: url('/private/files/IBM Plex Arabic SemiBold.otf') format('opentype');
            }

            .invoice-info {
                border: 1px solid red;
                display: block;
                direction: rtl;
                display: flex;
                justify-content: space-between;
                margin-bottom: 20px;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .invoice-info h3 {
                display: block;
                /* مهم للطباعة */
                margin-bottom: 10px;
                color: #118493 !important;
                border-bottom: 2px solid #000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            table th,
            table td {
                border: 2px solid #ddd;
                text-align: right;
                padding: 8px;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }


        }
    </style>
