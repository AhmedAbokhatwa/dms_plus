<div class="print-container">
    <!-- Header -->
    <div class="header">
        <div class="image-container">
            <img src="/private/files/DMS-Header.jpg.png" alt="">
        </div>
        <h1>عرض سعر</h1>

        <!-- Quotation Info -->
        <div class="quotation-info">
            <div class="supplier-section">
                <h3>المورد</h3>
                <div class="supplier-details">
                    <div>اسم الشركة: {{ doc.company }}</div>
                    {% set company_doc = frappe.get_doc("Company", doc.company) %}
                    <div>السجل التجاري: {{ company_doc.registration_no or "-" }}</div>
                    <div>الرقم الضريبي: {{ company_doc.tax_id or "-" }}</div>
                    <div>العنوان الوطني: {{ company_doc.address or "-" }}</div>
                </div>
            </div>

            <div class="customer-section">
                <h3>العميل</h3>
                <div class="customer-details">
                    <div>اسم الشركة: {{ doc.customer_name or "-" }}</div>
                    <div>السجل التجاري: {{ doc.customer_registration_no or "-" }}</div>
                    <div>الرقم الضريبي: {{ doc.customer_tax_id or "-" }}</div>
                    <div>العنوان الوطني: {{ doc.customer_address or "-" }}</div>
                    <div>رقم عرض السعر: {{ doc.name }}</div>
                    <div>تاريخ العرض: {{ doc.transaction_date or "-" }}</div>
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <table>
            <thead>
                <tr>
                    <th>التسلسل</th>
                    <th>اسم الصنف</th>
                    <th>الوصف</th>
                    <th>الكمية</th>
                    <th>سعر الوحدة</th>
                    <th>نسبة الخصم</th>
                    <th>قيمة الخصم</th>
                    <th>الإجمالي</th>
                </tr>
            </thead>

            <tbody>
                {% for item in doc.items %}
                <tr>
                    <td>{{ item.item_code }}</td>
                    <td>{{ item.item_name }}</td>
                    <td style="width: 100%; height:100%">{{ item.description }}</td>
                    <td>{{ item.qty }}</td>
                    <td>{{ "%.2f"|format(item.rate) }}</td>
                    <td>
                        {% if item.discount_amount %}
                        {{ "%.2f"|format((item.discount_amount / (item.rate * item.qty)) * 100) }}%
                        {% else %}
                        0%
                        {% endif %}
                    </td>
                    <td>
                        {% if item.discount_amount %}
                        {{ "%.2f"|format(item.discount_amount) }}
                        {% else %}
                        0.00 ر.س
                        {% endif %}
                    </td>
                    <td>{{ "%.2f"|format(item.amount) }} ر.س</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Totals -->
        <div class="totals-section">
            <div class="totals">
                <div class="total-row">
                    <span>الإجمالي قبل الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.total) }} ر.س</span>
                </div>

                {% if doc.discount_amount %}
                <div class="total-row">
                    <span>قيمة الخصم الإضافي:</span>
                    <span>{{ "%.2f"|format(doc.discount_amount) }} ر.س</span>
                </div>
                <div class="total-row">
                    <span>الإجمالي بعد الخصم:</span>
                    <span>{{ "%.2f"|format(doc.net_total) }} ر.س</span>
                </div>
                {% endif %}

                {% if doc.total_taxes_and_charges %}
                <div class="total-row">
                    <span>نسبة الضريبة %:</span>
                    <span>{{ "%.2f"|format(doc.total_taxes_and_charges / doc.net_total * 100) }}%</span>
                </div>
                <div class="total-row">
                    <span>قيمة الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.total_taxes_and_charges) }} ر.س</span>
                </div>
                {% endif %}

                <div class="total-row final">
                    <span>الإجمالي بعد الضريبة:</span>
                    <span>{{ "%.2f"|format(doc.grand_total) }} ر.س</span>
                </div>
                <div class="total-row final">
                    <span>المبلغ كتابة:</span>
                    <span>{{ "%.2f"|format(doc.grand_total) }} ر.س</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="image-container">
                <img src="/private/files/DMS-Footer.jpg" alt="">
            </div>
        </div>
    </div>

    <style>
        @font-face {
            font-family: 'IBM-Plex-Arabic';
            src: url('/private/files/IBM Plex Arabic SemiBold.otf') format('opentype');
        }

        .print-format {
            position: relative;
            background-color: white;
            border-radius: 10px !important;
            max-width: 8.3in;
            min-height: 11.69in;
            font-family: 'IBM-Plex-Arabic';
        }

        .print-format .print-container {
            position: absolute;
            width: 100%;
            height: 93%;
            padding: 25px;
            margin: -12px -70px;
        }

        .image-container {
            text-align: center;
            margin-bottom: 10px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            object-fit: cover;
        }

        .header h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #333;
        }

        .quotation-info {
            direction: rtl;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .quotation-info h3 {
            display: block !important;
            margin-bottom: 10px !important;
            color: #118493 !important;
            border-bottom: 2px solid #000 !important;
            font-weight: bold;
        }

        .supplier-section,
        .customer-section {
            width: 48%;
            padding: 0px 50px;
        }

        .supplier-details div,
        .customer-details div {
            margin-bottom: 5px;
        }

        table {
            direction: rtl;
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }

        table th,
        table td {
            border: 1px solid #ddd;
            text-align: right;
            padding: 8px;
        }

        table th {
            background-color: #f2f2f2;
            color: #118493;
            font-size: 12px;
            font-weight: bold;
        }

        table td {
            font-size: 13px;
            color: #333;
        }

        .totals-section {
            direction: rtl;
            text-align: right;
            padding: 10px 50px;
        }

        .totals .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .totals .total-row.final {
            font-weight: bold;
            font-size: 12px;
        }

        .footer {
            position: absolute;
            bottom: 0;
            margin-top: 20px;
            text-align: center;
        }

        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            .print-format .print-container {
                position: absolute;
                width: 100%;
                height: 93%;
                padding: 25px;
                margin: -12px -10px;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .quotation-info h3 {
                display: block !important;
                margin-bottom: 10px !important;
                color: #118493 !important;
                border-bottom: 2px solid #000 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            table th,
            table td {
                border: 2px solid #ddd;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
    </style>
</div>
